<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Exo&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Exo+2&display=swap" rel="stylesheet" />
    <link href="./css/VoterSpecified.css" rel="stylesheet" />
    <title>Voter Specified</title>
  </head>
  <body>

    <div class="banner">
      <p>
        <a href="HomePage.html">
          <img id="logo" src="Images/logo.png">
        </a>
      </p>
    </div>

    <div class="sidebar">
      <button id="ES" onclick="Election_settings()">Election Settings</button>
      <button id="CD" onclick="Candidates()">Candidates</button>
      <button id="VS" onclick="VoterSpecified()">Voters Specified</button>
      <button id="VW" onclick="ViewScores()">View Scores</button>
      <script>
        function Election_settings() {
          location.replace("Election_settings.html")
        }

        function Candidates() {
          location.replace("Candidates.html")
        }

        function VoterSpecified() {
          location.replace("VoterSpecified.html")
        }

        function ViewScores() {
          location.replace("view-scores.html")
        }
      </script>
    </div>

      <div id="container">
      <form method="POST" action="voter_specified.php">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email[]" placeholder="@up.edu.ph">
        <button type="button" id="addEmailBtn">Add Email</button>
        <button type="submit">Save Emails</button>
        <button id="export-btn">Export to Excel</button>
      </form>

      <div class="display-area">
        <h3>Voter Email List:</h3>
        <ul id="email-list">
          <?php foreach ($emailRows as $row): ?>
            <li><?php echo $row['email']; ?><button class="delete-btn">Delete</button></li>
          <?php endforeach; ?>
        </ul>
      </div>
    </div>


    <div class="footercolor"></div>
    <div class="sidecolor"></div>

    <div class="UPVTitle2"> University of the Philippines Visayas </div> 

   <script>
  const emailList = document.querySelector('#email-list');
  const form = document.querySelector('form');
  const input = document.querySelector('#email');
  const exportBtn = document.querySelector('#export-btn');
  const saveBtn = document.querySelector('#saveBtn');

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const email = input.value;
    const li = document.createElement('li');
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'Delete';

    li.textContent = email;
    li.appendChild(deleteBtn);
    emailList.appendChild(li);
    input.value = '';

    deleteBtn.addEventListener('click', () => {
      emailList.removeChild(li);
    });
  });

  saveBtn.addEventListener('click', () => {
    const email = input.value;

    // Manually submit the form
    form.submit();
  });

  exportBtn.addEventListener('click', () => {
    const rows = [];
    const emails = emailList.querySelectorAll('li');
    emails.forEach(email => {
      const emailText = email.textContent.replace('Delete', ''); // remove 'Delete' from the email text
      rows.push(emailText);
    });
    const csvContent = "data:text/csv;charset=utf-8," + rows.join("\n");
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "emails.csv");
    document.body.appendChild(link); 
    link.click();
  });
</script>

  </body>
</html>
